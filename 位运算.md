# 位运算

我是[iOS开发之位运算](http://allluckly.cn/%E6%8A%95%E7%A8%BF/tougao69)的笔记

直接操作这些二进制数据的位数据就是位运算。


## 基础计算

### 加法

当代码`int sum = 11 + 79`被执行的时候，计算机直接将两个数的二进制位进行相加**和进位操作(二进制的加法)**：

```
11:  0 0 0 0 1 0 1 1
79:  0 1 0 0 1 1 1 1
————————————————————
90:  0 1 0 1 1 0 1 0
```

> 通常来说CPU执行两个数相加操作所花费的时间被我们称作一个时钟周期，而2.0GHz频率的CPU表示可以在一秒执行运算2.0*1024*1024*1024个时钟周期。


### 乘法

```
11*4

相当于

11:  0 0 0 0 1 0 1 1  *  4
————————————————————
44:  0 0 1 0 1 1 0 0
```

某个数乘以`2的N次幂`的时候，结果等同于将这个数的二进制位置向左移动`N`位，在代码中我们使用`num << N`表示将`num`的二进制数据左移`N`个位置，其效果等同于下面这段代码：

```
//`num << N`相当于下面代码

for (int idx = 0; idx < N; idx++) {
    num *= 2;
}
```

假如相乘的两个数都不是`2的N次幂`，这时候编译器会将其中某个值分解成多个`2的N次幂`相加的结果进行运算。比如`37 * 69`，这时候CPU会将`37`分解成`32+4+1`，然后换算成`(69<<5) + (69<<2) + (69<<0)`的方式计算出结果。因此，计算两个数相乘通常需要十个左右的时钟周期。

### 除法


## 位运算符


含义	运算符
左移	«
右移	»
按位或	︳
按位并	&
按位取反	~
按位异或	^


```
0 0 1 0 1 1 1 0  46
1 0 0 1 1 1 0 1  157

0 0 0 0 1 1 0 0   --- 46 & 157 = 12

1 0 1 1 0 0 1 1   --- 46 ^ 157 = 179

1 0 1 1 1 1 1 1   --- 46 | 157 = 191

1 1 0 1 0 0 0 1   --- 46～ = 225
``


## Color

色彩取值范围为`0~255`(1 Byte = 8 bit = 2^8)，即2^1 ~ 2^8-1不超过一个字节的整数占用内存。因此可以通过左移运算保证每一个字节只存储了一个决定色彩的值：

```
- (int)rgbNumberWithRed: (int)red green: (int)green blue: (int)blue alpha: (float)alpha {
    int bitPerByte = 8;
    int maxNumber = 255;

    int alphaInt = alpha * maxNumber;
    int rgbNumber = (red << (bitPerByte*3)) + (green << (bitPerByte*2)) + (blue << bitPerByte) + alphaInt;
    /* R在高8位，G在中间8位，B低8位 */
}
```

同理，通过右移操作保证数值的最后一个字节存储着需要的数据，并用0xff将值取出来：

```
- (void)obtainRGBA: (int)rgbNumber {
    int mask = 0xff;
    int bitPerByte = 8;

    double alphaInt = (rgbNumber & mask) / 255.0;
    int blue = ((rgbNumber >> bitPerByte) & mask);
    int green = ((rgbNumber >> (bitPerByte*2)) & mask);
    int red = ((rgbNumber >> (bitPerByte*3)) & mask);
}
```

# 位运算应用

通过`|`操作符保证对应的二进制位的值被修改成`1`。否则对对应枚举进行`~`取反后再`&`操作消除二进制位的授权表达。

# 位运算与算法

在普遍使用高级语言开发的大环境下，位运算的实现更多的被封装起来，因此大多数开发者在项目开发中不见得会使用这一机制。在上面基础计算一节中笔者说过两个数相加只需要一个时钟周期（虽然CPU从寄存器读取存放数据也需要额外的时钟周期，但通常这部分的花销总是常量级，可以忽略不计）。
